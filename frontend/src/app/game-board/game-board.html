<div class="container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>{{ 'GAME.LOADING' | translate }}</p>
    </div>
  } @else if (!gameState()) {
    <div class="selection-area">
      <app-difficulty-selector (gameRequest)="createGame($event)"></app-difficulty-selector>

      <div class="start-screen-actions">
        <button (click)="openHighScores()" mat-stroked-button class="start-leaderboard-btn">
          <mat-icon svgIcon="leaderboard"></mat-icon>
          {{ 'MENU.HALL_OF_FAME' | translate }}
        </button>
      </div>

      @if (errorMessage()) {
        <div class="error-msg">{{ errorMessage()! | translate }}</div>
      }
    </div>
  } @else if (gameState(); as game) {
    <mat-card class="game-area">
      <div class="game-header-bar">
        <div class="stats-group">
          <div class="stat-item" [title]="'GAME.STATS.TIME' | translate">
            <mat-icon svgIcon="timer"></mat-icon>
            {{ formattedTime() }}
          </div>
          <div class="stat-item" [title]="'GAME.STATS.LIVES' | translate">
            <mat-icon svgIcon="lives"></mat-icon>
            {{ game.livesLeft }}
          </div>
          <div class="stat-item" [title]="'GAME.STATS.MINES' | translate">
            <mat-icon svgIcon="bomb"></mat-icon>
            {{ game.mineCount }}
          </div>
          <div class="stat-item" [title]="'GAME.STATS.FLAGS' | translate">
            <mat-icon svgIcon="flag"></mat-icon>
            {{ game.marksLeft }}
          </div>
        </div>

        <div class="spacer"></div>

        <div class="actions-group">
          <button
            (click)="openHighScores()"
            mat-stroked-button
            class="header-action-btn"
            [matTooltip]="'MENU.RANKINGS' | translate"
          >
            <mat-icon svgIcon="leaderboard"></mat-icon>
            <span class="btn-label">{{ 'MENU.RANKINGS' | translate }}</span>
          </button>

          <button
            (click)="onPlayAgain()"
            mat-flat-button
            color="primary"
            class="header-action-btn"
            [matTooltip]="'MENU.RESTART' | translate"
          >
            <mat-icon svgIcon="refresh"></mat-icon>
            <span class="btn-label">{{ 'MENU.RESTART' | translate }}</span>
          </button>

          <button
            (click)="onChangeDifficulty()"
            mat-flat-button
            class="header-action-btn"
            [matTooltip]="'MENU.CHANGE_DIFFICULTY' | translate"
          >
            <mat-icon svgIcon="change"></mat-icon>
            <span class="btn-label">{{ 'MENU.CHANGE_DIFFICULTY' | translate }}</span>
          </button>
        </div>
      </div>

      <div
        class="board"
        [style.grid-template-columns]="'repeat(' + game.columns + ', 1fr)'"
        (contextmenu)="$event.preventDefault()"
      >
        @for (row of game.grid; track $index) {
          @for (cell of row; track cell.x + '-' + cell.y) {
            <div
              class="cell"
              [ngClass]="getCellClass(cell)"
              (click)="onLeftClick(cell)"
              (contextmenu)="onRightClick($event, cell)"
            >
              @if (isFlagged(cell)) {
                <mat-icon class="cell-icon flag" svgIcon="flag"></mat-icon>
              } @else if (showMineIcon(cell)) {
                <mat-icon class="cell-icon mine" svgIcon="mine"></mat-icon>
              } @else if (showNumber(cell)) {
                <span class="adj-count" [attr.data-count]="cell.adjacentMines">{{
                    cell.adjacentMines
                  }}</span>
              }
            </div>
          }
        }
      </div>
    </mat-card>
  }
</div>
